<!DOCTYPE html>
<html>
<head><title>TIDO</title>
  <meta charset="utf-8">
  <meta name="description" content="">
  <meta name="format-detection" content="telephone=no">
  <meta name="msapplication-tap-highlight" content="no">
  <meta name="viewport" content="initial-scale=1,maximum-scale=5,minimum-scale=1,width=device-width">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" href="dist/tido.css">
  <style>
      html, body {
          margin: 0;
      }

      #app {
          height: 100vh;
      }
  </style>
</head>
<body>
<div id="app"></div>
<script src="dist/tido.min.js"></script>
<script>
  function parseFormEncoded(queryString) {
    const params = new URLSearchParams(queryString);
    const result = {};

    for (const [key, value] of params.entries()) {
      const keys = key.split(/\[|\]/).filter(Boolean); // Split nested keys (e.g., "person[name]" â†’ ["person", "name"])
      let current = result;

      while (keys.length > 1) {
        const nextKey = keys.shift();
        if (!current[nextKey]) {
          current[nextKey] = isNaN(keys[0]) ? {} : []; // Detect if next key is an array index
        }
        current = current[nextKey];
      }

      const finalKey = keys.shift();
      current[finalKey] = value;
    }

    return result;
  }

  function deepMerge(target, source) {
    if (Array.isArray(target) && Array.isArray(source)) {
      return target.map((item, index) =>
        typeof item === "object" && typeof source[index] === "object"
          ? deepMerge(item, source[index])
          : source[index] ?? item
      ).concat(source.slice(target.length)); // Append extra items
    }

    if (typeof target === "object" && typeof source === "object") {
      for (const key in source) {
        target[key] = deepMerge(target[key], source[key]);
      }
      return target;
    }

    return source ?? target;
  }

  const defaultConfig = {
    panels: [{
      collection: "http://localhost:8181/4w/reproduction/collection.json"
    }],

  }

  const urlConfig = parseFormEncoded(window.location.search)
  const config = deepMerge(defaultConfig, urlConfig);

  new window.Tido(config);
</script>
</body>
</html>
